<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GAME CENTER - PREMIUM VERSION</title>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #00D2BE; --secondary: #FFD93D; --accent: #FF6B6B; --bg: #F0F4F8; --card-bg: #FFFFFF; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { font-family: 'Kanit', sans-serif; margin: 0; background: var(--bg); color: #2D3436; height: 100vh; overflow: hidden; }
        
        /* ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏∏‡∏ö‡πÅ‡∏•‡∏∞‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå‡πÇ‡∏Ñ‡πâ‡∏á‡∏°‡∏ô */
        .btn, .key { transition: all 0.1s ease; cursor: pointer; border-radius: 20px; border: none; font-family: 'Kanit'; }
        .btn:active, .key:active { transform: scale(0.92); }
        
        input { width: 100%; padding: 18px; border-radius: 25px; border: 2px solid #E2E8F0; text-align: center; font-family: 'Kanit'; font-size: 1.1rem; margin-bottom: 15px; box-shadow: inset 0 2px 4px rgba(0,0,0,0.05); }

        .page-layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: none; align-items: center; justify-content: center; padding: 20px; z-index: 10; }
        .active-layer { display: flex !important; z-index: 100 !important; }
        .card { background: var(--card-bg); padding: 30px; border-radius: 35px; width: 100%; max-width: 420px; box-shadow: 0 20px 40px rgba(0,0,0,0.08); text-align: center; }
        
        .btn-primary { background: linear-gradient(135deg, var(--primary), #00BFA5); color: white; font-weight: 600; padding: 15px; width: 100%; margin-top: 10px; }
        .btn-game { background: white; border: 2px solid var(--primary); color: var(--primary); margin: 5px; padding: 10px; flex: 1; }

        /* Keypad */
        .keypad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-top: 20px; }
        .key { background: #F8FAFC; padding: 20px; font-size: 1.5rem; font-weight: 600; box-shadow: 0 4px 0 #CBD5E1; }
        
        /* Feedback Overlays */
        .feedback-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: 35px; display: none; align-items: center; justify-content: center; font-size: 5rem; z-index: 110; background: rgba(255,255,255,0.9); }
        .correct-icon { color: #00D2BE; }
        .wrong-icon { color: #FF6B6B; }

        @keyframes countZoom { 0% { transform: scale(0); opacity: 0; } 50% { transform: scale(1.2); opacity: 1; } 100% { transform: scale(1); opacity: 1; } }
        .count-num { font-size: 8rem; color: var(--primary); font-weight: 800; animation: countZoom 0.5s infinite alternate; }
    </style>
</head>
<body>

    <div id="layer-welcome" class="page-layer active-layer">
        <div class="card">
            <h1 style="color:var(--primary)">MATH CODE</h1>
            <div style="text-align:left; font-size:0.85rem; background:#F1F5F9; padding:15px; border-radius:20px; margin-bottom:15px;">
                1. ‡∏î.‡∏ä.‡∏ä‡∏±‡∏¢‡πÄ‡∏°‡∏ò ‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏≠‡∏°‡∏£‡πÄ‡∏ß‡∏ä ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà 2<br>
                2. ‡∏î.‡∏ä.‡∏ì‡∏±‡∏ê‡∏û‡∏á‡∏©‡πå ‡∏≠‡∏±‡∏á‡∏®‡∏ß‡∏≤‡∏Ñ‡∏° ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà 3<br>
                3. ‡∏î.‡∏ç.‡∏Å‡∏≤‡∏ô‡∏ï‡∏¥‡πå‡∏ä‡∏ô‡∏¥‡∏ï ‡∏õ‡∏£‡∏∞‡πÄ‡∏™‡∏£‡∏¥‡∏ê‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà 14<br>
                4. ‡∏î.‡∏ç.‡∏ä‡∏ô‡∏¥‡∏™‡∏£‡∏≤ ‡∏ä‡∏∞‡πÄ‡∏≠‡∏° ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà 15<br>
                5. ‡∏î.‡∏ç.‡∏ß‡∏¥‡∏†‡∏≤‡∏î‡∏≤ ‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏à‡∏£‡∏¥‡∏ç ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà 26
            </div>
            <button class="btn btn-primary" onclick="changeLayer('layer-lock')">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</button>
        </div>
    </div>

    <div id="layer-lock" class="page-layer">
        <div class="card">
            <h2>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</h2>
            <input type="text" id="p-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì" maxlength="10">
            <button class="btn btn-primary" onclick="registerPlayer()">‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°</button>
        </div>
    </div>

    <div id="layer-lobby" class="page-layer">
        <div class="card">
            <h3>‚è≥ ‡∏´‡πâ‡∏≠‡∏á‡∏£‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</h3>
            <div id="lobby-list" style="margin: 20px 0; min-height: 100px;"></div>
            <p>‡∏£‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°...</p>
        </div>
    </div>

    <div id="layer-countdown" class="page-layer" style="background:white;">
        <div class="count-num" id="cd-text">5</div>
    </div>

    <div id="layer-game-math" class="page-layer">
        <div class="card" style="position:relative;">
            <div id="feedback-correct" class="feedback-overlay correct-icon">‚úÖ</div>
            <div id="feedback-wrong" class="feedback-overlay wrong-icon">‚ùå</div>
            <div style="background:#F0FDFA; padding:15px; border-radius:20px; border:2px dashed var(--primary); margin-bottom:15px;">
                <b id="quest-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏∏‡πà‡∏°‡πÇ‡∏à‡∏ó‡∏¢‡πå...</b>
            </div>
            <div id="code-display" style="font-size:2.5rem; letter-spacing:8px; color:var(--primary); font-weight:800; margin:10px;">____</div>
            <div class="keypad">
                <button class="key" onclick="press('1')">1</button><button class="key" onclick="press('2')">2</button><button class="key" onclick="press('3')">3</button>
                <button class="key" onclick="press('4')">4</button><button class="key" onclick="press('5')">5</button><button class="key" onclick="press('6')">6</button>
                <button class="key" onclick="press('7')">7</button><button class="key" onclick="press('8')">8</button><button class="key" onclick="press('9')">9</button>
                <button class="key" style="background:#FFE4E6; color:#E11D48;" onclick="press('DEL')">‚å´</button><button class="key" onclick="press('0')">0</button><button class="key" style="background:var(--primary); color:white;" onclick="checkAns()">‡∏ï‡∏Å‡∏•‡∏á</button>
            </div>
        </div>
    </div>

    <div id="layer-admin" class="page-layer">
        <div class="card">
            <h3>‚öôÔ∏è Admin Control</h3>
            <div style="display:flex;">
                <button class="btn btn-game" onclick="adminTrigger('MATH')">‡∏™‡∏°‡∏Å‡∏≤‡∏£</button>
                <button class="btn btn-game" onclick="adminTrigger('SUDOKU')">Sudoku</button>
                <button class="btn btn-game" onclick="adminTrigger('GAME24')">Game 24</button>
            </div>
            <button class="btn btn-primary" style="background:black" onclick="loadAdminManage(); changeLayer('layer-manage')">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</button>
        </div>
    </div>

    <div id="layer-manage" class="page-layer"><div class="card"><h3>üë• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</h3><div id="manage-box"></div><button class="btn btn-primary" onclick="changeLayer('layer-admin')">‡∏Å‡∏•‡∏±‡∏ö</button></div></div>
    <div id="layer-scoreboard" class="page-layer"><div class="card"><h2>üèÜ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h2><div id="score-box"></div><button class="btn btn-primary" onclick="location.reload()">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button></div></div>
    <div id="layer-banned" class="page-layer" style="background:red;"><div class="card" style="border:5px solid white;"><h1>‚õî</h1><h2>‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°</h2><p>‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏û‡∏±‡∏í‡∏ô‡∏≤</p></div></div>
    <div id="layer-unlocking" class="page-layer" style="background:var(--primary);"><div style="font-size:100px; color:white;">üîì</div></div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyDJf-qOOB_hmP1higooEpMSFe2768dMxfE", databaseURL: "https://mathpasswordgame2-default-rtdb.asia-southeast1.firebasedatabase.app/" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let myName = "", currentCode = "", targetAns = "", isBanned = false, gameTimer = null;

        function changeLayer(id) {
            document.querySelectorAll('.page-layer').forEach(l => l.classList.remove('active-layer'));
            document.getElementById(id).classList.add('active-layer');
        }

        // --- ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á ---
        const audio = {
            whistle: () => { try { let ctx = new AudioContext(); let osc = ctx.createOscillator(); osc.type='sine'; osc.frequency.setValueAtTime(2000, ctx.currentTime); osc.connect(ctx.destination); osc.start(); osc.stop(ctx.currentTime+0.5); } catch(e){} },
            wrong: () => { try { let ctx = new AudioContext(); let osc = ctx.createOscillator(); osc.type='sawtooth'; osc.frequency.setValueAtTime(150, ctx.currentTime); osc.connect(ctx.destination); osc.start(); osc.stop(ctx.currentTime+0.3); } catch(e){} },
            beep: () => { try { let ctx = new AudioContext(); let osc = ctx.createOscillator(); osc.connect(ctx.destination); osc.start(); osc.stop(ctx.currentTime+5); } catch(e){} }
        };

        function registerPlayer() {
            myName = document.getElementById('p-name').value.trim();
            if(!myName) return;
            db.ref('players/'+myName).set({ name: myName, status: 'ready', banned: false });
            changeLayer('layer-lobby');
            setInterval(updateLobby, 1000);
            listenStatus();
        }

        function listenStatus() {
            db.ref('players/'+myName).on('value', s => {
                const p = s.val(); if(!p) return;
                if(p.banned && !isBanned) { isBanned=true; audio.beep(); changeLayer('layer-banned'); }
                else if(!p.banned && isBanned) { isBanned=false; changeLayer('layer-unlocking'); setTimeout(()=>changeLayer('layer-lobby'), 1500); }
                
                if(p.status === 'countdown') startCountdown();
            });
        }

        function startCountdown() {
            changeLayer('layer-countdown');
            let c = 5;
            let itv = setInterval(() => {
                c--; document.getElementById('cd-text').innerText = c;
                if(c <= 0) {
                    clearInterval(itv);
                    audio.whistle();
                    newQuestion();
                    changeLayer('layer-game-math');
                    db.ref('players/'+myName).update({startTime: Date.now()});
                }
            }, 1000);
        }

        function newQuestion() {
            const x = Math.floor(Math.random() * 9) + 1;
            const y = Math.floor(Math.random() * 9) + 1;
            targetAns = `${x}${y}00`;
            document.getElementById('quest-text').innerText = `2x + 10 = ${2*x+10} | y - 1 = ${y-1} (‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏∑‡∏≠ xy00)`;
            currentCode = "";
            document.getElementById('code-display').innerText = "____";
        }

        function press(k) {
            if(k === 'DEL') currentCode = currentCode.slice(0, -1);
            else if(currentCode.length < 4) currentCode += k;
            document.getElementById('code-display').innerText = currentCode.padEnd(4, '_');
        }

        function checkAns() {
            if(currentCode === targetAns) {
                document.getElementById('feedback-correct').style.display = 'flex';
                setTimeout(() => {
                    db.ref('players/'+myName).update({status:'finished', finishTime: Date.now()});
                    updateScores();
                    changeLayer('layer-scoreboard');
                }, 1000);
            } else {
                audio.wrong();
                document.getElementById('feedback-wrong').style.display = 'flex';
                setTimeout(() => {
                    document.getElementById('feedback-wrong').style.display = 'none';
                    newQuestion();
                }, 1000);
            }
        }

        // --- Admin ---
        function adminTrigger(game) {
            db.ref('players').once('value', s => {
                s.forEach(c => { if(c.key !== 'admin') db.ref('players/'+c.key).update({status: 'countdown'}); });
            });
        }

        function updateLobby() {
            db.ref('players').once('value', s => {
                let h = ""; s.forEach(c => { if(c.key!=='admin') h+=`<div>‚óè ${c.val().name}</div>`; });
                document.getElementById('lobby-list').innerHTML = h;
            });
        }

        function updateScores() {
            db.ref('players').once('value', s => {
                let list = []; s.forEach(c => { if(c.val().finishTime) list.push(c.val()); });
                list.sort((a,b) => (a.finishTime-a.startTime) - (b.finishTime-b.startTime));
                let h = ""; list.forEach((p,i) => h += `<div>${i+1}. ${p.name} - ${((p.finishTime-p.startTime)/1000).toFixed(2)}s</div>`);
                document.getElementById('score-box').innerHTML = h;
            });
        }

        function openAdminAuth() { if(prompt("‡∏£‡∏´‡∏±‡∏™:") === "182137") { myName="admin"; changeLayer('layer-admin'); } }
        window.onclick = (e) => { if(e.clientX < 30 && e.clientY < 30) openAdminAuth(); };
    </script>
</body>
</html>
